## Spring Cloud服务

### 服务降级

当服务不可用时，启用替代的方案

### 服务熔断

> https://www.cnblogs.com/songjilong/p/12770999.html

当服务在一定时间内服务降级达到指定次数，将启用服务熔断，这个服务将被视为不可用，也就是说不再尝试调用这个服务，直接进行服务降级，并且启用服务熔断后即使服务马上恢复可用，也需要等待一段时间

**熔断转态**

- 熔断打开：请求不再调用当前服务，内部设置时钟一般为MTTR（平均故障处理时间），当熔断器打开时长达到所设时钟则进入半熔断状态。 
- 熔断半开：部分请求根据规则调用服务，如果请求成功且符合规则，则关闭熔断。
- 熔断关闭：不会对服务进行熔断。

 **断路器开启之后会发生什么？**

- 再有请求调用时，不再调用主逻辑，而是调用降级 fallback。
- 断路器开启之后，Hytrix 会启动一个休眠时间窗(默认5秒)，在此时间内，fallback 会临时称为主逻辑，当休眠期到了之后，断路器进入半开状态，释放一个请求到原来的主逻辑上，如果请求成功返回，则断路器关闭，如果请求失败，则熔断器继续进入打开状态，休眠时间窗重新计时

## 并发

springMVC中，一般Controller、service、DAO层的scope均是singleton；

每个请求都是单独的线程,即使同时访问同一个Controller对象，因为并没有修改Controller对象，相当于针对Controller对象而言，只是读操作，没有写操作，不需要做同步处理。

Service层、Dao层用默认singleton就行，虽然Service类也有dao这样的属性，但dao这些类都是没有状态信息的，也就是 相当于不变(immutable)类，所以不影响。

Struts2中的Action因为会有User、BizEntity这样的实例对象，是有状态信息 的，在多线程环境下是不安全的，所以Struts2默认的实现是Prototype模式。在Spring中，Struts2的Action中scope 要配成prototype作用域。